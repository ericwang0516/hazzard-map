# 地圖聚合功能說明

## 功能概述

當地圖縮放等級較小時（zoom < 17），相近的危險項目標記會自動聚合為一個圓圈，顯示該區域內危險項目的數量。

## 功能特點

### 1. 智能聚合
- 縮放等級 ≥ 17：顯示所有個別標記
- 縮放等級 < 17：自動聚合相近的標記（50公尺範圍內）

### 2. 聚合標記設計
- 圓圈顏色根據聚合數量變化：
  - 1-2個：黃色 (#ffc107)
  - 3-4個：黃色 (#ffc107)
  - 5-9個：橙色 (#fd7e14)
  - 10個以上：紅色 (#dc3545)

- 圓圈大小根據聚合數量調整：
  - 1-2個：35px
  - 3-4個：40px
  - 5-9個：45px
  - 10個以上：50px

### 3. 互動功能
- 點擊聚合標記會顯示詳細的危險項目列表
- 點擊包含多個項目的聚合標記會自動縮放到該區域
- 點擊單個項目的聚合標記會觸發原有的點擊事件

## 技術實現

### 文件結構
```
components/
├── ClusterMarker.js      # 聚合標記組件
├── ClusterMarkers.js     # 聚合標記管理組件
└── MapComponent.js       # 主地圖組件

utils/
└── clusterUtils.js       # 聚合邏輯工具函數

styles/
└── components/
    └── map.module.css    # 聚合標記樣式
```

### 核心功能
1. **距離計算**：使用 Haversine 公式計算兩個座標點之間的距離
2. **聚合算法**：根據縮放等級和距離閾值進行標記聚合
3. **動態更新**：監聽地圖縮放事件，動態更新聚合狀態
4. **SVG 圖標**：動態生成聚合標記的 SVG 圖標

## 使用方法

聚合功能已自動整合到地圖組件中，無需額外配置。當用戶縮放地圖時，標記會自動聚合或分離。

## 自定義選項

可以在 `utils/clusterUtils.js` 中調整以下參數：
- `clusterRadius`：聚合距離閾值（預設 50 公尺）
- 聚合顏色和大小規則
- 縮放等級閾值 